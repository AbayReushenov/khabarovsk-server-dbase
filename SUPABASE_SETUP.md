# üóÑÔ∏è Supabase Database Setup Guide

**–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Khabarovsk Forecast Buddy**

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Supabase

### 1.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞** [supabase.com](https://supabase.com)
2. **–ù–∞–∂–º–∏—Ç–µ "Start your project"** –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç
3. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç**:
   - **Organization**: –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é
   - **Name**: `khabarovsk-forecast-buddy`
   - **Database Password**: —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (–°–û–•–†–ê–ù–ò–¢–ï –ï–ì–û!)
   - **Region**: `Europe West (Ireland)` –∏–ª–∏ –±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º
   - **Pricing Plan**: `Free tier` (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

4. **–ñ–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è** (2-3 –º–∏–Ω—É—Ç—ã)

### 1.2 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí API** (–ª–µ–≤–æ–µ –º–µ–Ω—é)
2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ**:

```bash
# Project URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abcdefgh.supabase.co)
Project URL: ___________________________

# anon public key (–¥–ª–∏–Ω–Ω—ã–π JWT token)
anon public: ___________________________

# service_role key (–°–ï–ö–†–ï–¢–ù–´–ô –∫–ª—é—á!)
service_role: __________________________
```

**‚ö†Ô∏è –í–ê–ñ–ù–û**: `service_role` –∫–ª—é—á - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π! –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –µ–≥–æ.

## üìã –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

### 2.1 –û—Ç–∫—Ä—ã—Ç–∏–µ SQL Editor

1. –í Supabase Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–ª–µ–≤–æ–µ –º–µ–Ω—é)
2. –ù–∞–∂–º–∏—Ç–µ **"New query"**

### 2.2 –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Å–∫—Ä–∏–ø—Ç–∞

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** —Ñ–∞–π–ª–∞ `supabase_schema.sql`
2. **–í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor**
3. **–ù–∞–∂–º–∏—Ç–µ "Run"** (–∏–ª–∏ Ctrl+Enter)

### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ Tables created: sales_data, forecasts, csv_upload_logs, api_usage_stats
‚úÖ Indexes created
‚úÖ RLS policies enabled
‚úÖ Sample data inserted
‚úÖ Views created
```

## üìã –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–ó–∞–º–µ–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ `.env` –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–∏ –Ω–æ–≤—ã–µ:

```bash
# Supabase Database Configuration
SUPABASE_URL=https://–í–ê–®_PROJECT_ID.supabase.co
SUPABASE_ANON_KEY=–í–ê–®_ANON_KEY
SUPABASE_SERVICE_KEY=–í–ê–®_SERVICE_KEY
```

### 3.2 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ current dev script (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
./start-dev.sh
```

## üìã –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# Health check –¥–æ–ª–∂–µ–Ω —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—Ç—å
curl http://localhost:8000/api/v1/health

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "status": "healthy",
  "timestamp": "2024-07-10T15:30:00Z",
  "version": "1.0.0"
}
```

### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö
curl http://localhost:8000/api/v1/data/DOWN_JACKET_001

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å sample –¥–∞–Ω–Ω—ã–µ
```

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Table Editor** ‚Üí **sales_data**
2. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å sample –∑–∞–ø–∏—Å–∏:

| sku_id | date | units_sold | revenue | price |
|--------|------|------------|---------|-------|
| DOWN_JACKET_001 | 2024-01-01 | 5 | 35000 | 7000 |
| DOWN_JACKET_001 | 2024-01-02 | 3 | 21000 | 7000 |
| ... | ... | ... | ... | ... |

## üîß Troubleshooting

### ‚ùå "connection refused"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### ‚ùå "permission denied"

**–ü—Ä–∏—á–∏–Ω–∞**: RLS policies –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `SUPABASE_SERVICE_KEY` –≤ –±—ç–∫–µ–Ω–¥–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ policies —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```sql
-- –í SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
SELECT * FROM pg_policies WHERE tablename = 'sales_data';
```

### ‚ùå "table does not exist"

**–ü—Ä–∏—á–∏–Ω–∞**: SQL —Å–∫—Ä–∏–ø—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
SELECT tablename FROM pg_tables WHERE schemaname = 'public';
```

3. –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `supabase_schema.sql`

### ‚ùå Frontend –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω–∞**: CORS –∏–ª–∏ RLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ anon policies —Å–æ–∑–¥–∞–Ω—ã:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å anon policies
SELECT * FROM pg_policies WHERE roles @> '{anon}';
```

2. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ RLS:

```sql
-- –¢–û–õ–¨–ö–û –î–õ–Ø –û–¢–õ–ê–î–ö–ò!
ALTER TABLE sales_data DISABLE ROW LEVEL SECURITY;
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **`sales_data`** - –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂
   - `sku_id` - ID —Ç–æ–≤–∞—Ä–∞
   - `date` - –¥–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏
   - `units_sold` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü
   - `revenue` - –≤—ã—Ä—É—á–∫–∞
   - `price` - —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É

2. **`forecasts`** - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã
   - `sku_id` - ID —Ç–æ–≤–∞—Ä–∞
   - `forecast_type` - —Ç–∏–ø –ø—Ä–æ–≥–Ω–æ–∑–∞ (7/14/30 –¥–Ω–µ–π)
   - `predicted_units` - –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂
   - `predicted_revenue` - –ø—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏
   - `ai_explanation` - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç GigaChat

3. **`csv_upload_logs`** - –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
4. **`api_usage_stats`** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### –ü–æ–ª–µ–∑–Ω—ã–µ views:

- **`sales_analytics`** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
- **`recent_forecasts`** - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. ‚úÖ **Health check** —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ç—É—Å 200)
2. ‚úÖ **Upload CSV** —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **Generate forecast** —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚úÖ **Frontend** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ API

**–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!**

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase Dashboard](https://supabase.com/dashboard)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)

---

**üéâ Happy coding with Supabase!**

*Khabarovsk Forecast Buddy Team*
