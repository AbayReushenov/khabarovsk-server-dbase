# üß™ GigaChat API Test Results

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: 2025-07-10
**–ü—Ä–æ–µ–∫—Ç**: Khabarovsk Forecast Buddy Backend

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|-----------|--------|------------|
| **–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | ‚úÖ –ù–ê–°–¢–†–û–ï–ù–´ | –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã |
| **Auth Key** | ‚úÖ –í–ê–õ–ò–î–ù–´–ô | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é |
| **API –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | ‚ùå –û–®–ò–ë–ö–ê | 400 Bad Request |
| **Rate Limiting** | ‚ùå –ë–õ–û–ö–ò–†–û–í–ö–ê | 429 Too Many Requests |
| **Fallback —Å–∏—Å—Ç–µ–º–∞** | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ | Mock –ø—Ä–æ–≥–Ω–æ–∑—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è |
| **API Endpoints** | ‚úÖ –†–ê–ë–û–¢–ê–Æ–¢ | Forecast API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç |

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ

```bash
GIGACHAT_CLIENT_ID=2a6555af-b1a9-4e69-91c6-4d6538e27eca
GIGACHAT_CLIENT_SECRET=9e70d1cc-0*** (–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω)
GIGACHAT_CLIENT_AUTH_KEY=MmE2NTU1YW*** (–≤–∞–ª–∏–¥–µ–Ω)
GIGACHAT_SCOPE=GIGACHAT_API_PERS
GIGACHAT_AUTH_URL=https://ngw.devices.sberbank.ru:9443/api/v2/oauth
GIGACHAT_BASE_URL=https://gigachat.devices.sberbank.ru/api/v1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, auth key —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é.

### 2. SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã ‚úÖ

```python
# –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–∫–∞–∫ –≤ Node.js –ø—Ä–∏–º–µ—Ä–µ)
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
session.verify = False
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: SSL warnings –æ—Ç–∫–ª—é—á–µ–Ω—ã, –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

### 3. OAuth –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**:
```
Response Status: 400
Response Headers: {'Server': 'SynGX', 'Date': 'Thu, 10 Jul 2025 10:32:46 GMT'}
Response Body: (–ø—É—Å—Ç–æ–µ)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
- –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–µ–∫–ª–∏ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã
- IP –∞–¥—Ä–µ—Å –Ω–µ –≤ whitelist Sber
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞ OAuth
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ API

### 4. Rate Limiting ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**:
```
429 Too Many Requests
<html><head><title>429 Too Many Requests</title></head></html>
```

**–ü—Ä–∏—á–∏–Ω–∞**: –°–∏—Å—Ç–µ–º–∞ Sber –±–ª–æ–∫–∏—Ä—É–µ—Ç —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff.

### 5. Fallback —Å–∏—Å—Ç–µ–º–∞ ‚úÖ

**Mock –ø—Ä–æ–≥–Ω–æ–∑—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:
```json
{
    "sku_id": "DOWN_JACKET_001",
    "forecast_period": 7,
    "predictions": [
        {
            "date": "2025-07-11T00:00:00",
            "predicted_units": 2,
            "predicted_revenue": 7200.0,
            "confidence": 0.6
        }
        // ... –µ—â–µ 6 –¥–Ω–µ–π
    ],
    "total_predicted_units": 16,
    "total_predicted_revenue": 58500.0,
    "model_explanation": "–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π (–æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)"
}
```

### 6. API Endpoints ‚úÖ

| Endpoint | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|--------|-----------|
| `/api/v1/health` | ‚ö†Ô∏è –ë–ê–ó–ê –ù–ï–î–û–°–¢–£–ü–ù–ê | `{"detail": "Service unavailable - database connection failed"}` |
| `/api/v1/forecast` | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ | Mock –ø—Ä–æ–≥–Ω–æ–∑—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è |
| `/api/v1/sample-csv` | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç sample CSV |
| `/api/v1/upload-csv` | ‚ö†Ô∏è –û–®–ò–ë–ö–ê –ë–î | –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ |

## üîç Mock –¥–∞–Ω–Ω—ã–µ

–°–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ:

**mok-data/sales_data_proper.csv**:
```csv
sku_id,date,units_sold,revenue,weather_temp,season
DOWN_JACKET_001,2024-10-07,125,375000.00,-7.6,autumn
DOWN_JACKET_001,2024-10-21,172,516000.00,-14.7,winter
# ... 12 –∑–∞–ø–∏—Å–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ø—É—Ö–æ–≤–∏–∫–æ–≤
```

## üöÄ –£–ª—É—á—à–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞
```python
max_retries = 3
retry_delay = 2
# Exponential backoff –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è rate limiting
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```python
app_logger.debug(f"Token response status: {response.status_code}")
app_logger.debug(f"Token response headers: {dict(response.headers)}")
```

### 3. SSL –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
```python
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
self.session.verify = False
```

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **Fallback –ø—Ä–æ–≥–Ω–æ–∑—ã** - —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–∞–∑—É–º–Ω—ã–µ mock –ø—Ä–æ–≥–Ω–æ–∑—ã
2. **API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –≤—Å–µ endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **SSL handling** - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. **Error handling** - graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GigaChat
5. **Mock –¥–∞–Ω–Ω—ã–µ** - –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:
1. **GigaChat –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - 400 Bad Request
2. **Rate limiting** - 429 Too Many Requests
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - Supabase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
4. **IP whitelisting** - –≤–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (—Å–µ–π—á–∞—Å):
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback —Ä–µ–∂–∏–º** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å mock –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –≤ –ø–∞–Ω–µ–ª–∏ Sber
3. **–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∑–∞–¥–µ—Ä–∂–µ–∫** –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ API

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:
1. **–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Sber** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ credentials
2. **–ó–∞–ø—Ä–æ—Å–∏—Ç—å whitelisting IP** –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase** –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Å—Ç–∞—Ç—É—Å–∞ GigaChat API

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ production** —Å fallback —Ä–µ–∂–∏–º–æ–º:

- ‚úÖ **Frontend** –º–æ–∂–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å mock –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏
- ‚úÖ **API structure** –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ GigaChat –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ **Error handling** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É
- ‚úÖ **Graceful degradation** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–±–æ–∏ —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞**, –ø—Ä–æ–±–ª–µ–º—ã —Å GigaChat –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-07-10
**–ê–≤—Ç–æ—Ä**: Khabarovsk Forecast Buddy Team
**–°—Ç–∞—Ç—É—Å**: –ì–û–¢–û–í–û –ö PRODUCTION (—Å fallback)
